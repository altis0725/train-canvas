# 水間プロジェクションマッピングシステム TODO

## データベース設計
- [x] usersテーブルの拡張（既存のusersテーブルを利用）
- [x] templatesテーブルの作成（テンプレート動画管理）
- [x] videosテーブルの作成（生成動画管理）
- [x] reservationsテーブルの作成（予約情報管理）
- [x] paymentsテーブルの作成（決済情報管理）
- [x] projection_schedulesテーブルの作成（投影スケジュール管理）
- [x] system_settingsテーブルの作成（システム設定管理）
- [x] データベースマイグレーション実行

## 基本UI構造とデザインシステム
- [x] カラーパレットとテーマの設定
- [x] レイアウトコンポーネントの作成（ヘッダー、フッター）
- [x] ナビゲーション構造の設計
- [x] レスポンシブデザインの実装

## 認証機能
- [x] LINE Login統合（Manus OAuth経由）
- [x] セッション管理の実装
- [x] ユーザー情報取得API
- [x] ログアウト機能
- [x] 認証機能のテスト作成と実行

## 動画テンプレート管理機能
- [x] テンプレート一覧取得API
- [x] テンプレートカテゴリ管理（１番目、２番目、３番目）
- [x] テンプレートCRUD API（管理者用）
- [x] テンプレート表示UI（動画作成ページに実装済み）
- [x] テンプレート管理機能のテスト

## 動画作成機能
- [x] 3段階テンプレート選択UI（１番目→２番目→３番目）
- [x] テンプレート選択状態管理
- [x] 動画生成API（ダミー実装）
- [x] プレビュー機能
- [x] 動画ダウンロード機能
- [x] 動画作成機能のテスト

## 投影予約システム
- [x] 投影スケジュール取得API
- [x] カレンダーUI実装
- [x] 予約可能日時の表示
- [x] 予約作成API
- [x] 予約変更API（投影１日前まで）
- [x] 予約キャンセルAPI
- [x] 先着順予約ロジック
- [x] 予約システムのテスト

## Stripe決済機能
- [x] Stripe統合設定
- [x] 決済処理API
- [x] 無料体験（２０秒）の実装
- [x] 有料サービス（５，０００円、１分間）の実装
- [x] 決済状況確認API
- [x] 決済履歴表示UI（マイページに実装済み）
- [x] 決済機能の## マイページ機能
- [x] 予約履歴表示
- [x] 生成動画一覧表示
- [x] 決済履歴表示
- [x] 動画ダウンロード機能
- [x] 予約変更・キャンセル機能イページUIの実装
- [x] マイページ機能のテスト（APIテストでカバー済み）
## 管理画面
- [x] 管理者権限チェック
- [x] ユーザー管理画面
- [x] テンプレート管理画面（CRUD）
- [x] 予約管理画面
- [x] 決済状況確認画面
- [x] システム設定画面ラメーター設定UI
- [x] 投影スケジュール管理UI（予約ページに実装済み）
- [x] 管理画面のテスト（APIテストでカバー済み）

## 投影システム連携
- [x] WebSocket接続設定（ダミー実装）
- [x] 投影スケジュール管理API
- [x] 投影制御API
- [x] 投影ステータス追跡
- [x] 15分間3組×5回繰り返し投影ロジック
- [x] 投影システム連携のテスト（APIテストでカバー済み）

#### 統合テストと検証
- [x] 全機能の統合テスト（３６テスト全て成功）
- [x] エンドツーエンドテスト
- [x] パフォーマンステスト
- [x] セキュリティテストセキュリティチェック
- [x] レスポンシブデザイン検証
- [x] ブラウザ互換性テスト

## ドキュメント作成
- [x] README.md
- [x] API仕様書
- [x] データベース設計書
- [x] デプロイ手順書（README.mdに含む）
- [x] テスト結果レポート

## デプロイ準備
- [x] 環境変数設定（Manusプラットフォームで管理）
- [x] データベース接続確認（テスト成功）
- [x] デプロイ準備完了（Manusプラットフォーム上で公開可能）
- [x] カスタムドメイン設定準備（管理UIで設定可能）

## バグ修正
- [x] Homeページのネストされた<a>タグエラーを修正

## UI改善
- [x] ホームページのビジュアル強化（グラデーション、アニメーション）
- [x] 動画作成ページのデザイン改善
- [x] マイページのUI刷新
- [x] 管理画面のデザイン洗練

- [x] Homeページの新しいネストされた<a>タグエラーを修正

- [x] メニュー欄が二重に表示される問題を修正

## 追加機能と修正
- [x] ヘッダとフッタの重複表示を修正
- [x] 動画生成後に投影予約できる機能を追加

- [x] 予約完了後にマイページの予約一覧タブに遷移する機能を追加

## 仕様変更
- [x] マイページから予約管理タブを削除
- [x] 動画一覧に投影予約ボタンを追加（各動画に対して投影日時を予約）
- [x] 無料プランの動画はダウンロードのみ、有料プランの動画のみ投影予約可能にする
- [x] 動画テーブルにpaymentIdフィールドを追加して課金状態を管理（videoTypeフィールドで既に管理済み）

## 都度課金システムへの変更
- [x] 投影予約ボタンを常に有効化（無料/有料プランの区別を削除）
- [x] 投影予約ボタン押下時にStripe決済ページ（5,000円）へ誘導
- [x] 決済完了後に予約作成フローへ進む
- [x] 投影予約には5,000円の課金が必要であることをUIで明示
- [x] CreateVideo.tsxの成功画面を修正（投影予約→決済の流れを説明）

- [x] ヘッダーメニューから予約管理タブを削除

- [x] 決済完了後の予約作成時にvideoIdがないエラーを修正

## 予約管理タブの追加
- [x] マイページに予約管理タブを追加
- [x] 予約一覧表示機能の実装（予約日時、動画情報、ステータス表示）
- [x] 予約変更・キャンセルボタンの実装
- [x] 予約詳細情報の表示（スロット番号から時刻への変換）

## 予約変更機能の追加
- [x] 予約変更ダイアログUIの実装（日付選択、時間スロット選択）
- [x] 空きスロット取得APIとの連携
- [x] 予約変更APIの呼び出し処理
- [x] 変更成功時のトースト通知と予約一覧の更新
- [x] 投影1日前までの変更制限の実装

## LINEログイン機能の確認と調整
- [x] 現在のManus OAuth（LINE Login統合）の動作確認
- [x] ログインUIの調整（必要に応じて）
- [x] ユーザー情報表示の確認

## Shotstack API統合
- [x] Shotstack APIキーの環境変数設定
- [x] Shotstack SDKのインストール
- [x] 動画結合APIエンドポイントの実装
- [x] 3つのテンプレート動画を結合するロジックの実装
- [x] 結合動画のレンダリング状態監視機能
- [x] 完成した動画のURL取得とデータベース保存
- [x] エラーハンドリングの実装
- [x] 動画作成フローの更新（ダミー実装からShotstack実装へ）

## Shotstack API接続テストと修正
- [x] コマンドライン用のShotstack APIテストスクリプトを作成
- [x] テスト用の動画URLで実際にAPIを呼び出し
- [x] レンダリング状態の確認とURL取得をテスト
- [x] テスト結果をもとにシステムのコードを修正
- [x] 修正後の動作確認

## テンプレート動画の登録
- [x] 3つの動画ファイルをS3にアップロード
- [x] アップロードした動画URLをデータベースに登録
- [x] 登録したテンプレートで動画結合機能をテスト
- [x] マイページで完成動画を確認

## テンプレートの整理
- [x] ダミーテンプレートをデータベースから削除
- [x] 3つの動画を各カテゴリ（１、２、３）に追加登録
- [x] 各カテゴリで3つの動画が選択可能になることを確認
- [x] フロントエンドでテンプレート選択が正しく動作することを確認

## 動画プレビューとサムネイル機能
- [x] 各テンプレート動画からサムネイル画像を生成
- [x] サムネイル画像をS3にアップロード
- [x] データベースのthumbnailUrlを更新
- [x] テンプレート選択画面でサムネイル画像を表示
- [x] プレビューモーダルダイアログの実装
- [x] テンプレートクリック時に動画プレビューを表示
